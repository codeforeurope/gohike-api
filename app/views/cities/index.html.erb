<%- model_class = City -%>
<div class="page-header">
  <h1><%= t '.title', :default => model_class.model_name.human.pluralize %>
    <% if can? :manage, City %>
      <%= link_to t(:add_city), new_city_path, :class => "btn btn-large btn-success pull-right" %>
    <% end %>
  </h1>
</div>
<div class="span12">
  <%= gmaps("map_options" => {"detect_location" => false, "center_on_user" => false, "zoom" => 5},
            "circles" => {"data" => @circles_json, "options" => {"fillColor" => "#FF0000"}},
            "markers" => {"data" => @json, "options" => {"do_clustering" => true}
            }) %>

  <% content_for :scripts do %>
    <script type="text/javascript">
      Gmaps.map.callback = function () {
        //your code
        $(document).trigger('map:ready');
      }
    </script>
  <% end %>
</div>

<table class="table table-striped">
  <thead>
  <tr>
    <th><%= model_class.human_attribute_name(:name) %></th>
    <th><%= model_class.human_attribute_name(:state_province) %></th>
    <th><%= model_class.human_attribute_name(:country_code) %></th>
    <th></th>
    <th></th>
  </tr>
  </thead>
  <% @cities.each do |city| %>
    <tr>
      <td><%= city.name %></td>
      <td><%= city.state_province %></td>
      <td><%= city.country_code %></td>
      <td><%= link_to t(:details), city_path(city), :class => "btn btn-mini" %></td>
      <% if can? :manage, city %>
        <td><%= link_to t(:edit), edit_city_path(city), :class => "btn btn-mini btn-primary" %></td>
      <% end %>

    </tr>
  <% end %>
</table>

<br/>

